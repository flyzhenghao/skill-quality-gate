{
  "version": "1.0.0",
  "description": "Security detection patterns for Skill Quality Gate",

  "patterns": {
    "critical": [
      {
        "id": "dangerous_rm",
        "name": "Dangerous File Deletion",
        "pattern": "rm -rf\\s*[/~]|rm -rf\\s*\\$HOME|rm -rf\\s*\\$\\{HOME\\}",
        "description": "Detected rm -rf command targeting system or home directories",
        "remediation": "Use explicit paths and add confirmation prompts"
      },
      {
        "id": "sudo_usage",
        "name": "Privilege Escalation",
        "pattern": "\\bsudo\\b",
        "description": "Attempting to execute commands with root privileges",
        "remediation": "Document why sudo is needed or remove it"
      },
      {
        "id": "credential_access",
        "name": "Credential File Access",
        "pattern": "(cat|read|open|readFile).*(\\.\\/ssh\\/|\\.\\/aws\\/|\\.env|credentials|id_rsa|\\.pem|\\.key)",
        "description": "Attempting to read sensitive credential files",
        "remediation": "Remove credential access or use secure credential management"
      },
      {
        "id": "data_exfiltration",
        "name": "Data Exfiltration",
        "pattern": "curl.*(--data|-d|-F|@).*\\$|wget.*--post-data.*\\$",
        "description": "Sending data (potentially sensitive) to external servers",
        "remediation": "Document what data is being sent and to where"
      },
      {
        "id": "netcat_reverse_shell",
        "name": "Netcat Usage",
        "pattern": "\\bnc\\b.*(-e|-c|/bin/|bash|sh)",
        "description": "Netcat with shell execution - potential reverse shell",
        "remediation": "Remove netcat usage or provide clear documentation"
      },
      {
        "id": "eval_injection",
        "name": "Code Injection via eval",
        "pattern": "\\beval\\b.*\\$|eval.*\\$\\(",
        "description": "Evaluating dynamic code - extreme injection risk",
        "remediation": "Never use eval with user input or external data"
      },
      {
        "id": "cron_persistence",
        "name": "Cron Persistence",
        "pattern": "crontab\\s*(-l|-r|-e)|echo.*>>.*crontab",
        "description": "Modifying cron jobs - potential persistence mechanism",
        "remediation": "Document why cron modification is needed"
      },
      {
        "id": "launch_agent",
        "name": "macOS Launch Agent/Daemon",
        "pattern": "LaunchAgents|LaunchDaemons",
        "description": "Modifying macOS startup items - potential persistence",
        "remediation": "Document why startup modification is needed"
      }
    ],

    "high": [
      {
        "id": "rm_rf_general",
        "name": "rm -rf Command",
        "pattern": "rm\\s+-rf?\\b",
        "description": "Using rm -rf which can accidentally delete important files",
        "remediation": "Use safer alternatives like trash-cli or add confirmation"
      },
      {
        "id": "chmod_777",
        "name": "Dangerous Permissions",
        "pattern": "chmod\\s+(777|-R\\s+777|a\\+rwx)",
        "description": "Setting world-writable permissions",
        "remediation": "Use minimal required permissions (e.g., 755 or 644)"
      },
      {
        "id": "dynamic_execution",
        "name": "Dynamic Command Execution",
        "pattern": "\\bexec\\b|\\bsystem\\b|\\bspawn\\b|child_process\\.exec",
        "description": "Dynamic command execution with potential injection risk",
        "remediation": "Validate and sanitize all inputs before execution"
      },
      {
        "id": "hex_shellcode",
        "name": "Hex-encoded Content",
        "pattern": "\\\\x[0-9a-fA-F]{2}\\\\x[0-9a-fA-F]{2}",
        "description": "Hex-encoded strings - potential shellcode",
        "remediation": "Decode and document the purpose"
      },
      {
        "id": "encoded_commands",
        "name": "Encoded Commands",
        "pattern": "base64\\s*(-d|--decode)|atob\\(|Buffer\\.from\\(.*base64",
        "description": "Decoding base64 - may hide malicious commands",
        "remediation": "Document what is being decoded"
      }
    ],

    "medium": [
      {
        "id": "network_curl",
        "name": "Network Request (curl)",
        "pattern": "\\bcurl\\b",
        "description": "Making HTTP requests - verify target endpoints",
        "remediation": "Document API endpoints and data being sent"
      },
      {
        "id": "network_wget",
        "name": "Network Request (wget)",
        "pattern": "\\bwget\\b",
        "description": "Downloading files - verify source",
        "remediation": "Document download sources and verify checksums"
      },
      {
        "id": "env_access",
        "name": "Environment Variable Access",
        "pattern": "process\\.env|ENV\\[|getenv|\\$\\{.*\\}",
        "description": "Accessing environment variables - may contain secrets",
        "remediation": "Document which env vars are needed and why"
      },
      {
        "id": "base64_encoding",
        "name": "Base64 Encoding",
        "pattern": "base64\\b|btoa\\(|Buffer\\.from\\(",
        "description": "Encoding content - may obscure malicious code",
        "remediation": "Document what is being encoded"
      },
      {
        "id": "file_write",
        "name": "File Write Operations",
        "pattern": ">\\s*\\$|>>\\s*\\$|tee\\s.*\\$|writeFile.*\\$",
        "description": "Writing to files with dynamic paths",
        "remediation": "Validate file paths before writing"
      }
    ],

    "low": [
      {
        "id": "sensitive_path_mention",
        "name": "Sensitive Path Reference",
        "pattern": "\\.ssh|\\.aws|\\.env|credentials|password|secret|token|key",
        "description": "References to sensitive paths or terms",
        "remediation": "Review context to ensure no unauthorized access"
      },
      {
        "id": "chmod_general",
        "name": "Permission Changes",
        "pattern": "\\bchmod\\b",
        "description": "Changing file permissions",
        "remediation": "Verify permissions are appropriate"
      },
      {
        "id": "chown",
        "name": "Ownership Changes",
        "pattern": "\\bchown\\b",
        "description": "Changing file ownership",
        "remediation": "Document why ownership change is needed"
      }
    ]
  },

  "trusted_domains": [
    "github.com",
    "githubusercontent.com",
    "npmjs.org",
    "pypi.org",
    "api.github.com",
    "raw.githubusercontent.com"
  ],

  "suspicious_domains": [
    "pastebin.com",
    "0x0.st",
    "transfer.sh",
    "file.io"
  ],

  "exclude_patterns": {
    "directories": [
      "node_modules/",
      ".git/",
      "vendor/",
      "__pycache__/",
      ".venv/"
    ],
    "files": [
      "*.min.js",
      "*.bundle.js",
      "package-lock.json",
      "yarn.lock"
    ]
  }
}
